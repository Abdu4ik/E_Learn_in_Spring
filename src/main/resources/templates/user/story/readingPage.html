<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Reading page</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf_viewer.min.css" rel="stylesheet"
          type="text/css"/>
    <style>
        .wrapper {
            width: 800px;
            margin: 150px auto;
            padding: 20px;
            border-radius: 10px;
            background: white;
            box-shadow: 0px 10px 40px 0px rgba(47, 47, 47, .1);
        }
    </style>
</head>
<body>
<div class="alert-warning" th:value="${complete}"></div>
<div class="container" style="text-align: center">
    <h2 th:text="${content.title}"></h2>
    <h2 th:text="${content.author}"></h2>
    <h2 th:text="${content.score}"></h2>
</div>

<div class="row" style="margin-left: fill">
    <div id="pdf_container" class="col-lg-7 bg-body-secondary col--dialog-scrollablesm-11 m-4"></div>
    <div class="col-lg-4 bg-body-secondary col-sm-11 mx-4">
        <h1>Translator</h1>
        <section>
            <div class="input  ">
                <label>
                    <span>English ðŸ‡¬ðŸ‡§</span>
                    <textarea id="input" placeholder=" " rows="9" class="form-control  col-md-12 fs-5"
                              oninput="myFunction()"></textarea>
                </label>
            </div>
            <div class="output">
                <label>
                    <span>UzbekðŸ‡ºðŸ‡¿</span>
                    <textarea rows="9" id="output" readonly="readonly"
                              class="form-control  col-md-12 fs-5">
                        </textarea>
                </label>
            </div>
            <br>
        </section>
    </div>
    <div>
        <form th:action="@{/practise/story/comments/add/{id}(id=${content.id})}" method="post">
            <div class="col-md-4 offset-1">
                <label for="comment">Comment</label>
                <textarea placeholder="Leave your comment" class="form-control" id="comment" name="comment"
                          rows="4"></textarea>
            </div>
            <br>
            <div class="col-md-4 offset-1">
                <button class="btn btn-primary" type="submit">Add</button>
            </div>
        </form>
        <div th:if="${comments.size()==0}">
            <div class="col-md-5 offset-1" style="margin-left: 25px; background-color: #e9ecef; border-radius: 5px">
                <div style="margin-left: 30px">No comments</div>
            </div>
        </div>

        <div th:if="${comments.size()!=0}">

            <br>
            <div class="wrapper">
                <div class="col-md-5 offset-1" style="margin-left: 25px; background-color: #e9ecef; border-radius: 5px">
                    <div style="margin-left: 30px">
                        <br>
                        <h3 style="text-align: center">Comments</h3>
                        <br>
                    </div>
                </div>
                <br><br>
                <div th:each="comment, c : ${comments}">
                    <div class="col-md-5 offset-1"
                         style="margin-left: 25px; background-color: #e9ecef; border-radius: 5px">
                        <div th:if="${comment.userId.id.equals(userId)}">
                            <div>
                                <form th:action="@{/practise/story/comments/update/{id}(id=${comment.id})}"
                                      method="post">
                                    <textarea name="comment" th:text="${comment.comment}"></textarea>
                                    <button class="btn btn-primary btn-sm" type="submit">Update</button>
                                </form>
                                <form method="post"
                                      th:action="@{/practise/story/comments/delete/{id}(id=${comment.id})}">
                                    <button class="btn btn-danger btn-sm" type="submit">Delete</button>
                                </form>
                            </div>
                        </div>
                        <div th:unless="${comment.userId.id.equals(userId)}" style="margin-left: 30px">
                            <strong th:utext="${comment.comment}"></strong>
                        </div>
                        <div>
                            <p style="margin-left: 5px"
                               th:text="${#temporals.format(comment.createdAt, 'HH:mm dd-MM-yyyy')}"></p>
                            <form th:unless="${comment.userId.id.equals(userId)}"
                                  th:action="@{/users/see/{id}(id=${comment.userId?.id})}">
                                <button class="btn btn-primary btn-sm"
                                        style="margin-left: 5px; background-color: #0a53be"
                                        th:text="'commented by '+${comment.userId?.username}"></button>
                            </form>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                Reply
                            </button>
                        </div>
                    </div>
                    <br>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script type="text/javascript">


    function myFunction() {
        const x = document.getElementById("input").value;
        const url = "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=uz&dt=t&q=" + x; //console.log(url);
        $.getJSON(url, function (data) {
            $('textarea#output').val(data[0][0][0]);
        });
    }


    var pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js';
    var pdfDoc = null;
    var scale = 2.5;
    if (IsMobile()) {
        scale = 1.7
    }
    var resolution = IsMobile() ? 1.5 : 1; //Set Resolution as per Desktop and Mobile.

    function LoadPdfFromUrl(url) {
        //Read PDF from URL.
        console.log(url)
        pdfjsLib.getDocument(url).promise.then(function (pdfDoc_) {
            pdfDoc = pdfDoc_;

            //Reference the Container DIV.
            var pdf_container = document.getElementById("pdf_container");
            pdf_container.style.display = "block";
            pdf_container.style.height = IsMobile() ? "1200px" : "820px";

            //Loop and render all pages.
            for (var i = 1; i <= pdfDoc.numPages; i++) {
                RenderPage(pdf_container, i);
            }
        });
    };

    function RenderPage(pdf_container, num) {
        pdfDoc.getPage(num).then(function (page) {
            //Create Canvas element and append to the Container DIV.
            var canvas = document.createElement('canvas');
            canvas.id = 'pdf-' + num;
            ctx = canvas.getContext('2d');
            pdf_container.appendChild(canvas);

            //Create and add empty DIV to add SPACE between pages.
            var spacer = document.createElement("div");
            spacer.style.height = "20px";
            pdf_container.appendChild(spacer);

            //Set the Canvas dimensions using ViewPort and Scale.
            var viewport = page.getViewport({scale: scale});
            canvas.height = resolution * viewport.height;
            canvas.width = resolution * viewport.width;

            //Render the PDF page.
            var renderContext = {
                canvasContext: ctx,
                viewport: viewport,
                transform: [resolution, 0, 0, resolution, 0, 0]
            };

            page.render(renderContext);
        });
    };

    function IsMobile() {
        var r = new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini");
        return r.test(navigator.userAgent);
    }


</script>
</body>
</html>